<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teungku Zulkifli — Blog</title>

  <!-- Favicon -->
  <link rel="icon" href="assets/img/Teungku.ico" type="image/x-icon" />

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/index.css" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Dancing+Script&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Navbar -->
  <div id="navbar"></div>

  <!-- Main Content -->
  <main class="container">
    <section class="page-header">
      <!-- <img src="assets/img/PROJECT-white.png" alt="Blog Banner" class="page-banner" /> -->
      <h1 class="page-title">Blog & Tutorial</h1>
      <p class="page-subtitle">Kumpulan catatan perjalanan, eksperimen, dan tutorial.</p>
    </section>

    <!-- List View -->
    <div id="list-view" class="content">
      <ul id="posts-list" class="post-list"></ul>
    </div>

    <!-- Post View -->
    <div id="post-view" class="content" style="display:none;">
      <button id="back" class="btn">← Kembali</button>
      <article id="post-content" class="post-content"></article>
    </div>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- JS -->
  <script src="assets/js/marked.min.js"></script>
  <script>
    if (!window.marked) {
      document.write('<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"><\/script>');
    }
  </script>
  <script src="assets/js/script.js"></script>
  <script>
    const owner = 'TEUNGKU-ZULKIFLI';
    const repo = 'TEUNGKU-ZULKIFLI.github.io';
    const path = 'blog';

    async function listPosts() {
      const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const res = await fetch(api);
      if (!res.ok) {
        document.getElementById('posts-list').innerHTML = '<li>Tidak bisa mengambil daftar post.</li>';
        return;
      }
      const files = await res.json();
      const mdFiles = files
        .filter(f => f.name.endsWith('.md'))
        .sort((a, b) => b.name.localeCompare(a.name));

      const ul = document.getElementById('posts-list');
      ul.innerHTML = '';
      mdFiles.forEach(f => {
        const name = f.name.replace('.md', '');
        const parts = name.split('-');
        const date = parts.slice(0, 3).join('-');
        const title = parts.slice(3).join(' ').replace(/\b\w/g, c => c.toUpperCase());

        const li = document.createElement('li');
        li.className = 'post-item';
        li.innerHTML = `<a href="#" data-download="${f.download_url}">
                          <strong>${title}</strong> <small>${date}</small>
                        </a>`;
        ul.appendChild(li);
      });

      ul.addEventListener('click', async (e) => {
        const a = e.target.closest('a');
        if (!a) return;
        e.preventDefault();
        const url = a.dataset.download;
        await loadPost(url);
      });
    }

    async function loadPost(rawUrl) {
      const res = await fetch(rawUrl);
      const md = await res.text();
      const content = md.replace(/^---[\s\S]*?---\s*/, '');
      document.getElementById('post-content').innerHTML = marked.parse(content);
      document.getElementById('list-view').style.display = 'none';
      document.getElementById('post-view').style.display = 'block';
      window.scrollTo(0, 0);
    }

    document.getElementById('back').addEventListener('click', () => {
      document.getElementById('post-view').style.display = 'none';
      document.getElementById('list-view').style.display = 'block';
    });

    document.addEventListener('DOMContentLoaded', () => {
      listPosts();
    });
  </script>
</body>
</html>
